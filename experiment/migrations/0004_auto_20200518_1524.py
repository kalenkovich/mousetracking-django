# Generated by Django 2.2.12 on 2020-05-18 12:24

from django.db import migrations


def create_test_trial(apps, schema_editor):
    Participant = apps.get_model('experiment', 'Participant')
    # There must be exactly one test participant
    test_participant = Participant.objects.get(is_test=True)

    Trial = apps.get_model('experiment', 'Trial')
    test_trial = Trial(participant=test_participant, number=1)

    # Add two images
    Image = apps.get_model('experiment', 'Image')
    acorn = Image.objects.create(name='acorn', uri='experiment/acorn.png')
    acorn.save()
    axe = Image.objects.create(name='axe', uri='experiment/axe.png')
    axe.save()

    # Add one audio
    Audio = apps.get_model('experiment', 'Audio')
    this_time_positive_bottom = Audio.objects.create(name='this-time_positive_bottom',
                                                     uri='experiment/this-time_positive_bottom.wav')
    this_time_positive_bottom.save()

    # Fill the trial fields
    test_trial.frame_top_left = acorn
    test_trial.frame_top_right = None
    test_trial.frame_bottom_left = axe
    test_trial.frame_bottom_right = None
    test_trial.frame_duration = 1500

    test_trial.response_option_left = acorn
    test_trial.response_option_right = axe

    test_trial.audio = this_time_positive_bottom
    test_trial.hold_duration = 1160

    test_trial.save()


class Migration(migrations.Migration):

    dependencies = [
        ('experiment', '0003_audio_image_trial'),
    ]

    operations = [
        migrations.RunPython(create_test_trial),
    ]